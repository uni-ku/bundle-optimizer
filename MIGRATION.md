# è¿ç§»æŒ‡å— | Migration Guide

æœ¬æŒ‡å—æ—¨åœ¨å¸®åŠ©å¼€å‘è€…å°† `@uni-ku/bundle-optimizer` å‡çº§è‡³æœ€æ–°ç‰ˆæœ¬ã€‚æ­¤æ¬¡æ›´æ–°åŒ…å«å¤šé¡¹ç ´åæ€§å˜æ›´ï¼Œæ¶‰åŠæ¨¡å—å¼‚æ­¥å¯¼å…¥ä¸ç»„ä»¶å¼‚æ­¥å¼•ç”¨ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œè¿ç§»ã€‚

---

## ğŸš¨ ç ´åæ€§å˜æ›´ (Breaking Changes)

### 1. æ¨¡å—å¼‚æ­¥å¯¼å…¥ï¼š`AsyncImport` æ›´åä¸º `import`
åŸæ¥çš„è‡ªå®šä¹‰å¼‚æ­¥å¯¼å…¥å‡½æ•° `AsyncImport` å·²è¢«åºŸå¼ƒï¼Œç°åœ¨ç›´æ¥ä½¿ç”¨ ESM åŸç”Ÿå¼‚æ­¥å¯¼å…¥è¯­æ³• `import()`ã€‚æ’ä»¶ä¼šè‡ªåŠ¨å¤„ç†å¤šç«¯å…¼å®¹æ€§ï¼ˆå¦‚åœ¨å°ç¨‹åºç«¯è½¬è¯‘ä¸º `require.async`ï¼‰ã€‚

### 2. ç»„ä»¶å¼‚æ­¥å¼•ç”¨ï¼šç§»é™¤ `?async` æŸ¥è¯¢å‚æ•°
ä¸å†æ”¯æŒé€šè¿‡ `import Component from './Comp.vue?async'` çš„æ–¹å¼å£°æ˜å¼‚æ­¥ç»„ä»¶ã€‚è¯·æ”¹ç”¨é…ç½®å¼å£°æ˜ã€‚

### 3. ç§»é™¤ `dts` è‡ªåŠ¨ç”ŸæˆåŠŸèƒ½
æ’ä»¶ä¸å†è´Ÿè´£ç”Ÿæˆ `async-import.d.ts` å’Œ `async-component.d.ts` ç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œç›¸å…³çš„ `dts` é…ç½®å‚æ•°ä¹Ÿå·²ç§»é™¤ã€‚

### 4. æš‚åœå¯¹ Vue æ–‡ä»¶çš„ `import()` åŠ¨æ€å¯¼å…¥æ”¯æŒ
- ç›®å‰åœ¨ä»£ç ä¸­ä½¿ç”¨ `import('./Comp.vue').then(...)` è¿™ç§æ–¹å¼åŠ¨æ€åŠ è½½ Vue æ–‡ä»¶ä¼šä¸åˆ†åŒ…ä¼˜åŒ–é€»è¾‘å†²çªï¼Œå¯èƒ½å¯¼è‡´ç»„ä»¶/é¡µé¢ç©ºç™½ã€‚è¯·æš‚æ—¶åœæ­¢ä½¿ç”¨è¿™ç§å†™æ³•ã€‚
- å†µä¸”è¿™ç§åšæ³•åœ¨å°ç¨‹åºç«¯æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼Œæœ¬é¡¹ç›®çš„æ—©å‰ç¤ºä¾‹åªæ˜¯ä¸€ä¸ªæç«¯æµ‹è¯•ã€‚
> æ³¨ï¼šé’ˆå¯¹ JS/TS æ¨¡å—çš„åŠ¨æ€å¯¼å…¥ `import('./module.ts')` ä»ç„¶æ­£å¸¸æ”¯æŒã€‚

---

## ğŸ›  è¿ç§»æ­¥éª¤ (Migration Steps)

### 1. æ¨¡å—å¯¼å…¥è¿ç§» (AsyncImport -> import)

å…¨å±€æœç´¢ `AsyncImport` å¹¶æ›¿æ¢ä¸º `import`ã€‚

**ä¿®æ”¹å‰ (Before):**
```ts
AsyncImport('@/utils/test').then((res) => {
  res.doSomething()
})
```

**ä¿®æ”¹å (After):**
```ts
import('@/utils/test').then((res) => {
  res.doSomething()
})
```

### 2. ç»„ä»¶å¼•ç”¨è¿ç§» (Config-based)

å…¨å±€æœç´¢ `?async` å­—ç¬¦ä¸²ï¼Œç§»é™¤åç¼€å¹¶æ·»åŠ  `componentPlaceholder` é…ç½®ã€‚

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨ `<script setup>` (æ¨è)
```vue
<script setup lang="ts">
// âœ… ç§»é™¤ ?async åç¼€
import SubComponent from '@/pages-sub/component.vue'

// âœ… æ·»åŠ  componentPlaceholder é…ç½®
defineOptions({
  componentPlaceholder: {
    SubComponent: 'view'
  }
})
</script>
```

#### æ–¹å¼äºŒï¼šä½¿ç”¨é€‰é¡¹å¼ API
```vue
<script>
import SubComponent from '@/pages-sub/component.vue'

export default {
  components: { SubComponent },
  // âœ… æ·»åŠ é…ç½®
  componentPlaceholder: {
    SubComponent: 'view'
  }
}
</script>
```

### 3. æ¸…ç†é…ç½®æ–‡ä»¶ä¸ç¯å¢ƒ

*   **`vite.config.ts`**: ç§»é™¤æ’ä»¶é…ç½®ä¸­çš„ `dts` é€‰é¡¹ã€‚
*   **æ–‡ä»¶æ¸…ç†**: åˆ é™¤é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `async-import.d.ts` å’Œ `async-component.d.ts`ã€‚
*   **`tsconfig.json`**: ç§»é™¤å¯¹ä¸Šè¿° `.d.ts` æ–‡ä»¶çš„å¼•ç”¨ã€‚
*   **`.gitignore`**: ç§»é™¤ç›¸å…³å¿½ç•¥è§„åˆ™ã€‚

---

## â“ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆè¦ç»Ÿä¸€ä½¿ç”¨åŸç”Ÿ `import()`ï¼Ÿ**
- A: é™ä½å­¦ä¹ æˆæœ¬ï¼Œæä¾›æ›´å¥½çš„ IDE ç±»å‹æ”¯æŒï¼Œå¹¶ä½¿ä»£ç æ›´ç¬¦åˆæ ‡å‡†ã€‚

**Q: åŠ¨æ€ `import()` Vue æ–‡ä»¶ï¼Œå¯¼è‡´æ–‡ä»¶å¯¹åº”çš„ç»„ä»¶ã€é¡µé¢ç©ºç™½äº†æ€ä¹ˆåŠï¼Ÿ**
- A: å½“å‰ç‰ˆæœ¬ä¸‹ç¦æ­¢å†ä½¿ç”¨è¿™ç§åšæ³•ï¼Œå†µä¸”è¿™ç§åšæ³•åœ¨å°ç¨‹åºç«¯æ˜¯æ²¡æœ‰æ•ˆæœçš„ï¼›å½“å‰ç‰ˆæœ¬è¿™ç§è¡Œä¸ºä¸åˆ†åŒ…ä¼˜åŒ–çš„æŸä¸€ä¸ªè¡Œä¸ºæœ‰äº›è®¸å†²çªã€‚
- å¦‚æœçœŸçš„æ˜¯è¦å¼‚æ­¥è·¨åŒ…å¼•ç”¨ä¸€ä¸ªç»„ä»¶ï¼Œåˆ™æ”¹ç”¨æœ¬æ–‡æ¡£æ¨èçš„ `componentPlaceholder` é…ç½®å¼æ–¹æ¡ˆæ¥å®ç°ç»„ä»¶çš„å¼‚æ­¥è·¨åŒ…å¼•ç”¨ã€‚

**Q: `componentPlaceholder` çš„å€¼åº”è¯¥å¡«ä»€ä¹ˆï¼Ÿ**
- A: é€šå¸¸å¡«å†™ `'view'` å³å¯ã€‚
